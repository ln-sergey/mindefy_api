version: 2.1
jobs:
  build:
    docker:
      - image: circleci/node:latest
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: npm install
      - run:
          name: Run tests
          command: npm test
  deploy-production:
    docker:
      - image: docker/compose:latest
    environment:
      - REMOTE_HOST=$PROD_REMOTE_HOST
      - REMOTE_USER=$PROD_REMOTE_USER
      - SSH_KEY=$PRIVATE_SSH_KEY
    steps:
      - checkout
      - run:
          name: Deploy to production
          command: |
            ssh -i $SSH_KEY $REMOTE_USER@$REMOTE_HOST << EOF
            cd /path/to/your/application
            git pull
            docker-compose -f docker-compose.prod.yml up -d
            EOF
  deploy-dev:
    docker:
      - image: docker/compose:latest
    environment:
      - REMOTE_HOST=$PROD_REMOTE_HOST
      - REMOTE_USER=$PROD_REMOTE_USER
      - SSH_KEY=$PRIVATE_SSH_KEY
    steps:
      - checkout
      - run:
          name: Deploy to dev
          command: |
            ssh -i $SSH_KEY $REMOTE_USER@$REMOTE_HOST << EOF
            cd /path/to/your/application
            git pull
            docker-compose -f docker-compose.dev.yml up -d
            EOF
